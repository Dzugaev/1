--1--
select distinct st.name, st.surname, h.name
from students st, hobbies h, students_hobbies sh
where sh.student_id = sh.hobby_id
group by st.name, st.surname, h.name
order by st.surname
/*
select st.surname, h.name
from students st, hobbies h, students_hobbies sh
where st.surname = 'Дзугаев' and h.id=sh.hobby_id
group by st.surname, h.name*/


--2--
with tab as(
select sh.student_id, extract (month from age (now(), sh.date_start)) as maximum
from students_hobbies sh
where sh.date_finish is null
group by sh.student_id, sh.date_start
order by maximum desc
limit 1)
select st.*
from students st
inner join tab
on st.id = tab.student_id

--3--
select st.name, st.surname, st.score, avg(st.score), sum(h.risk)
from students st
inner join students_hobbies sh
on st.id=sh.student_id
inner join hobbies h
on h.id = sh.hobby_id
group by st.name, st.surname, st.score
having sum(h.risk)>0.9 and st.score>(select avg(score) from students)

--4--
select st.name, st.surname, st.id, st.birth_date, h.name, (extract (month from age (sh.date_finish, sh.date_start))+extract (year from age (sh.date_finish, sh.date_start))*12) as dlitel
from students st
inner join students_hobbies sh
on st.id=sh.student_id
inner join hobbies h
on h.id = sh.hobby_id
where sh.date_finish is not null
group by st.name, st.surname, st.id, st.birth_date, h.name, dlitel

--5--
select st.name, st.surname, st.id, st.birth_date
from students st
inner join students_hobbies sh
on st.id=sh.student_id
inner join hobbies h
on h.id = sh.hobby_id
where (sh.date_finish is null) and (extract (year from st.birth_date ) > 1999)
group by st.name, st.surname, st.id, st.birth_date
having count(*) > 1
